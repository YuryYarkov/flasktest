<!DOCTYPE html>
<html xmlns:onload="http://www.w3.org/1999/xhtml" lang="ru">
<head>
    <title>Математика</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <link href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://getbootstrap.com/docs/4.1/examples/offcanvas/offcanvas.css" rel="stylesheet">

    <script src="https://ajax.aspnetcdn.com/ajax/jQuery/jquery-3.3.1.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.bundle.min.js"></script>
    <script src="http://ajax.aspnetcdn.com/ajax/knockout/knockout-3.4.2.js"></script>

</head>


<body onload="init_game_form();">

<nav class="navbar navbar-expand-md navbar-dark fixed-top bg-dark ">
    <a class="navbar-brand" href="#">Математика</a>
    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarCollapse"
            aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
    </button>
    <div class="collapse navbar-collapse" id="navbarCollapse">
        <ul class="navbar-nav mr-auto">
            <li class="nav-item active" id="menu_summ">
                <a class="nav-link" href="#" onclick="active_game = 1; init_game_form();">Сложение<span
                        class="sr-only">(current)</span></a>
            </li>
            <li class="nav-item active" id="menu_diff">
                <a class="nav-link" href="#" onclick="active_game = 2; init_game_form();">Вычитание</a>
            </li>
        </ul>
        <form class="form-inline mt-2 mt-md-0">
            <input class="form-control mr-sm-2" type="text" placeholder="Search" aria-label="Search">
            <button class="btn btn-outline-success my-2 my-sm-0" type="submit">Search</button>
        </form>
    </div>
</nav>

<main role="main" class="container">
    <div class="py-5">

        <div class="container" id="game_form" style="display: none">

            <div class="col-sm-6">
                <p class="lead" id="game_info"></p>
                <div class="row">
                    <div class="col-sm-8">
                        <p class="inner" id="result_topic">Верных ответов: 0 из 0</p>
                    </div>
                    <div class="col-sm-2">
                        <img id="stars_img" src="images/5starfull.png" alt="" height="32">
                    </div>
                </div>
            </div>

            <div class="row">
                <form class="need_validation" action="#">
                    <div class="row">
                        <div class="col-sm-3">
                            <p class="inner" id="par_1">23</p>
                            <input class="form-control" id="par_1_in" placeholder type="number" min="0"
                                   autocomplete="off"
                                   style="background-color: #A5D6D9">
                        </div>
                        <div class="col-sm">
                            <p class="inner" id="operation_char">+</p>
                        </div>
                        <div class="col-sm-3">
                            <p class="inner" id="par_2">64</p>
                            <input class="form-control" id="par_2_in" placeholder type="number" min="0"
                                   autocomplete="off"
                                   style="background-color: #A5D6D9">
                        </div>
                        <div class="col-sm">
                            <p class="inner">=</p>
                        </div>
                        <div class="col-sm-3">
                            <p class="inner" id="par_3">23</p>
                            <input class="form-control" id="par_3_in" placeholder type="number" min="0"
                                   autocomplete="off"
                                   style="background-color: #A5D6D9">
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-sm-8">
                            <p class="highlight" id="result_note"></p>
                        </div>
                    </div>
                    <hr class="mb-4">
                    <button class="btn btn-primary btn-lg btn-block" onclick="game_check();">Проверить</button>
                </form>
            </div>
        </div>

    <div class="container" id="game_setup" style="background-color: gainsboro;">
            <h3 class="text-center">Настройка параметров игры</h3>

            <form class="need_validation" action="#">
                <div class="row">
                    <div class="col-md mb-3">
                        <label>Тип игры</label>

                        <div class="d-block choose_game_type">
                            <div class="custom-control custom-radio">
                                <input id="summ" name="game_type" type="radio" class="custom-control-input" checked=""
                                       required="">
                                <label class="custom-control-label" for="summ">Суммирование</label>
                            </div>
                            <div class="custom-control custom-radio">
                                <input id="diff" name="game_type" type="radio" class="custom-control-input" required="">
                                <label class="custom-control-label" for="diff">Вычитание</label>
                            </div>
                        </div>
                    </div>
                    <div class="col-md mb-3">
                        <label>Сложность игры</label>
                        <select class="custom-select d-block w-100" id="game_level_select">
                            <option value="1">1 класс</option>
                            <option value="2">2 класс</option>
                            <option value="3">3 класс</option>
                        </select>
                    </div>
                    <div class="col-md mb-3">
                        <label>Примеров</label>
                        <select class="custom-select d-block w-100" id="try_quantity">
                            <option value="1">10</option>
                            <option value="2">20</option>
                            <option value="3">30</option>
                        </select>
                    </div>
                </div>
            </form>
        </div>
    </div>
</main>

<script type="text/javascript">

    let p1, p2, p3;
    let game_variant = 3;
    let games_exarcise = 0;
    let games_correct = 0;

    let active_game = 1;

    let games_level = 2;

    function getRandomInt(min, max) {
        return Math.floor(Math.random() * (max - min + 1)) + min;
    }

    function show_games_result() {
        self.result_topic.innerText = "Верных ответов: " + games_correct + " из " + games_exarcise;

        let stars = 1;

        if (games_exarcise !== 0) {
            stars = games_correct / games_exarcise * 5 + 1;
            if (stars === 6) stars--;
        }

        stars_img.src = "images/" + Math.round(stars) + "starfull.png";
    }

    function init_game_form() { // инициализация перед первым запуском или сменой игры

        if (active_game === 1) { // суммирование
            self.game_info.innerText = "Суммирование. Введи недостающее значение";
            self.operation_char.innerText = "+";
        } else if (active_game === 2) { // вычитание
            self.game_info.innerText = "Вычитание. Введи недостающее значение";
            self.operation_char.innerText = "-";
        }

        new_game_round();
    }

    function new_game_round() {
        show_games_result();

        game_variant = getRandomInt(1, 3);

        if (active_game === 1) {
            if (games_level === 1) {
                p1 = getRandomInt(1, 50);
                p2 = getRandomInt(1, 50 - p1);
            } else if (games_level == 2) {
                p1 = getRandomInt(1, 90);
                p2 = getRandomInt(1, 100 - p1);
            } else if (games_level === 3) {
                p1 = getRandomInt(1, 900);
                p2 = getRandomInt(1, 1000 - p1);
            }
            p3 = p1 + p2;
        } else if (active_game === 2) {
            if (games_level === 1) {
                p1 = getRandomInt(10, 50);
                p2 = getRandomInt(1, p1 - 1);
            } else if (games_level == 2) {
                p1 = getRandomInt(10, 99);
                p2 = getRandomInt(1, p1 - 1);
            } else if (games_level === 3) {
                p1 = getRandomInt(100, 999);
                p2 = getRandomInt(99, p1 - 1);
            }

            p3 = p1 - p2;
        }

        if (game_variant !== 1) {
            if (game_variant === 2) {
                self.par_1.style.display = "";
                self.par_1_in.style.display = "none";
                self.par_2.style.display = "none";
                self.par_2_in.style.display = "";
                self.par_3.style.display = "";
                self.par_3_in.style.display = "none";

                self.par_1.innerText = p1;
                self.par_2.innerText = "";
                self.par_2_in.value = "";
                self.par_3.innerText = p3;

                self.par_2_in.focus();
            } else {
                self.par_1.style.display = "";
                self.par_1_in.style.display = "none";
                self.par_2.style.display = "";
                self.par_2_in.style.display = "none";
                self.par_3.style.display = "none";
                self.par_3_in.style.display = "";

                self.par_1.innerText = p1;
                self.par_2.innerText = p2;
                self.par_3.innerText = "";
                self.par_3_in.value = "";

                self.par_3_in.focus();
            }
        } else {
            self.par_1.style.display = "none";
            self.par_1_in.style.display = "";
            self.par_2.style.display = "";
            self.par_2_in.style.display = "none";
            self.par_3.style.display = "";
            self.par_3_in.style.display = "none";

            self.par_1.innerText = "";
            self.par_1_in.value = "";
            self.par_2.innerText = p2;
            self.par_3.innerText = p3;

            self.par_1_in.focus();
        }

    }

    function game_check() {
        let ap1, ap2, ap3;

        if (game_variant !== 1) {
            if (game_variant === 2) {
                ap1 = Number.parseInt(self.par_1.innerText);
                ap2 = Number.parseInt(self.par_2_in.value);
                ap3 = Number.parseInt(self.par_3.innerText);
            } else {
                ap1 = Number.parseInt(self.par_1.innerText);
                ap2 = Number.parseInt(self.par_2.innerText);
                ap3 = Number.parseInt(self.par_3_in.value);
            }
        } else {
            ap1 = Number.parseInt(self.par_1_in.value);
            ap2 = Number.parseInt(self.par_2.innerText);
            ap3 = Number.parseInt(self.par_3.innerText);
        }

        games_exarcise++;

        if (active_game === 1) {
            if ((ap1 + ap2) === ap3) {
                self.result_note.innerText = "ВЕРНО!";
                games_correct++;
                new_game_round();
            } else {
                self.result_note.innerText = "ОШИБКА! Попробуй ещё";
                show_games_result();
            }
        } else if (active_game === 2) {
            if ((ap1 - ap2) === ap3) {
                self.result_note.innerText = "ВЕРНО!";
                games_correct++;
                new_game_round();
            } else {
                self.result_note.innerText = "ОШИБКА! Попробуй ещё";
                show_games_result();
            }
        }
    }

</script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript">
    (function (m, e, t, r, i, k, a) {
        m[i] = m[i] || function () {
            (m[i].a = m[i].a || []).push(arguments)
        };
        m[i].l = 1 * new Date();
        k = e.createElement(t), a = e.getElementsByTagName(t)[0], k.async = 1, k.src = r, a.parentNode.insertBefore(k, a)
    })
    (window, document, "script", "https://mc.yandex.ru/metrika/tag.js", "ym");

    ym(51577088, "init", {
        id: 51577088,
        clickmap: true,
        trackLinks: true,
        accurateTrackBounce: true,
        webvisor: true
    });
</script>
<noscript>
    <div><img src="https://mc.yandex.ru/watch/51577088" style="position:absolute; left:-9999px;" alt=""/></div>
</noscript>
<!-- /Yandex.Metrika counter -->

</body>
</html>